<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patel Dairy Pro Ultimate</title>

<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#141e30,#243b55);
color:white;
}

.container{padding:15px}

.card{
background:rgba(255,255,255,0.08);
padding:15px;
border-radius:15px;
margin-bottom:15px;
backdrop-filter:blur(15px);
}

input,select,button{
width:100%;
padding:10px;
margin:5px 0;
border-radius:8px;
border:none;
}

button{
background:#00ffcc;
color:black;
font-weight:bold;
cursor:pointer;
}

button:hover{background:white}

.hidden{display:none}

h2{color:#00ffcc}
table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}
td,th{
border:1px solid white;
padding:5px;
text-align:center;
}
</style>
</head>
<body>

<div class="container">

<div id="auth">
<div class="card">
<h2>Signup</h2>
<input id="suUser" placeholder="Username">
<input id="suPass" type="password" placeholder="Password">
<button onclick="signup()">Signup</button>
</div>

<div class="card">
<h2>Login</h2>
<input id="liUser" placeholder="Username">
<input id="liPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>
</div>

<div id="app" class="hidden">

<div class="card">
<h2>Dashboard</h2>
<p id="summary"></p>
<button onclick="logout()">Logout</button>
</div>

<div class="card">
<h2>Add Customer</h2>
<input id="custName" placeholder="Customer Name">
<input id="milkPrice" placeholder="Price per Litre">
<button onclick="addCustomer()">Add</button>
</div>

<div class="card">
<h2>Daily Milk Entry</h2>
<select id="custSelect"></select>
<input type="date" id="entryDate">
<input id="entryMilk" placeholder="Milk Litres">
<button onclick="addEntry()">Add Entry</button>
</div>

<div class="card">
<h2>Customer Full Report</h2>
<select id="reportSelect" onchange="showCustomerReport()"></select>
<div id="customerReport"></div>
</div>

<div class="card">
<h2>Daily Production</h2>
<input type="date" id="prodDate">
<input id="morningMilk" placeholder="Morning Milk">
<input id="eveningMilk" placeholder="Evening Milk">
<button onclick="saveProduction()">Save Production</button>
</div>

<div class="card">
<h2>Add Cow</h2>
<input id="cowName" placeholder="Cow Name">
<button onclick="addCow()">Add Cow</button>
</div>

<div class="card">
<h2>Feed Cost</h2>
<input id="feedCost" placeholder="Total Feed Cost">
<button onclick="saveFeed()">Save Cost</button>
</div>

<div class="card">
<h2>Production Graph</h2>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h2>Backup / Restore</h2>
<button onclick="backup()">Download Backup</button>
<input type="file" onchange="restore(event)">
</div>

</div>
</div>

<script>
if('serviceWorker' in navigator){
navigator.serviceWorker.register('sw.js');
}

let currentUser=null;
let customers=[],entries=[],production=[],cows=[],feed=0;

function getKey(k){return currentUser+"_"+k}

function signup(){
localStorage.setItem("user_"+suUser.value,suPass.value);
alert("Signup Success");
}

function login(){
if(localStorage.getItem("user_"+liUser.value)===liPass.value){
currentUser=liUser.value;
auth.classList.add("hidden");
app.classList.remove("hidden");
loadAll();
}else alert("Wrong Login");
}

function logout(){location.reload();}

function loadAll(){
customers=JSON.parse(localStorage.getItem(getKey("customers")))||[];
entries=JSON.parse(localStorage.getItem(getKey("entries")))||[];
production=JSON.parse(localStorage.getItem(getKey("production")))||[];
cows=JSON.parse(localStorage.getItem(getKey("cows")))||[];
feed=parseFloat(localStorage.getItem(getKey("feed")))||0;
refreshSelect();
loadSummary();
drawChart();
}

function addCustomer(){
customers.push({name:custName.value,price:milkPrice.value});
localStorage.setItem(getKey("customers"),JSON.stringify(customers));
refreshSelect();
}

function refreshSelect(){
custSelect.innerHTML="";
reportSelect.innerHTML="";
customers.forEach((c,i)=>{
custSelect.innerHTML+=`<option value="${i}">${c.name}</option>`;
reportSelect.innerHTML+=`<option value="${i}">${c.name}</option>`;
});
}

function addEntry(){
let c=customers[custSelect.value];
let total=entryMilk.value*c.price;
entries.push({date:entryDate.value,name:c.name,litre:entryMilk.value,total});
localStorage.setItem(getKey("entries"),JSON.stringify(entries));
loadSummary();
}

function showCustomerReport(){
let name=customers[reportSelect.value].name;
let data=entries.filter(e=>e.name===name);
let totalMilk=0,totalMoney=0;
let html="<table><tr><th>Date</th><th>Litre</th><th>Amount</th></tr>";
data.forEach(e=>{
totalMilk+=parseFloat(e.litre);
totalMoney+=parseFloat(e.total);
html+=`<tr><td>${e.date}</td><td>${e.litre}</td><td>${e.total}</td></tr>`;
});
html+="</table>";
html+=`<h3>Total Milk: ${totalMilk} L</h3>`;
html+=`<h3>Total Amount: ₹${totalMoney}</h3>`;
customerReport.innerHTML=html;
}

function saveProduction(){
let total=parseFloat(morningMilk.value||0)+parseFloat(eveningMilk.value||0);
production.push({date:prodDate.value,total});
localStorage.setItem(getKey("production"),JSON.stringify(production));
drawChart();
loadSummary();
}

function addCow(){
cows.push(cowName.value);
localStorage.setItem(getKey("cows"),JSON.stringify(cows));
}

function saveFeed(){
feed=parseFloat(feedCost.value);
localStorage.setItem(getKey("feed"),feed);
loadSummary();
}

function loadSummary(){
let totalMilk=entries.reduce((s,e)=>s+parseFloat(e.litre),0);
let totalMoney=entries.reduce((s,e)=>s+parseFloat(e.total),0);
let totalProd=production.reduce((s,p)=>s+p.total,0);
let profit=totalMoney-feed;
summary.innerHTML=
"Milk Sold: "+totalMilk+" L<br>"+
"Income: ₹"+totalMoney+"<br>"+
"Production: "+totalProd+" L<br>"+
"Profit: ₹"+profit;
}

function drawChart(){
new Chart(chart,{
type:"line",
data:{
labels:production.map(p=>p.date),
datasets:[{
label:"Production",
data:production.map(p=>p.total),
borderColor:"lime"
}]
}
});
}

function backup(){
let data={customers,entries,production,cows,feed};
let blob=new Blob([JSON.stringify(data)],{type:"application/json"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="backup.json";
a.click();
}

function restore(e){
let file=e.target.files[0];
let reader=new FileReader();
reader.onload=function(){
let data=JSON.parse(reader.result);
customers=data.customers;
entries=data.entries;
production=data.production;
cows=data.cows;
feed=data.feed;
localStorage.setItem(getKey("customers"),JSON.stringify(customers));
localStorage.setItem(getKey("entries"),JSON.stringify(entries));
localStorage.setItem(getKey("production"),JSON.stringify(production));
localStorage.setItem(getKey("cows"),JSON.stringify(cows));
localStorage.setItem(getKey("feed"),feed);
alert("Restored");
loadAll();
};
reader.readAsText(file);
}
</script>
</body>
</html>
