<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patel Farm Business Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family:Arial;
    margin:0;
    padding:0;
    background:#f4f6f9;
}

.login{
    max-width:400px;
    margin:100px auto;
    background:white;
    padding:20px;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
}

.container{
    display:none;
    padding:15px;
}

h1{
    text-align:center;
}

input,select,button{
    padding:8px;
    margin:5px 0;
    width:100%;
}

button{
    background:green;
    color:white;
    border:none;
    border-radius:5px;
}

canvas{
    margin-top:20px;
}
</style>
</head>

<body>

<!-- LOGIN PAGE -->
<div class="login" id="loginPage">
<h2>üîê Admin Login</h2>
<input type="password" id="password" placeholder="Enter Password">
<button onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div class="container" id="dashboard">

<h1>üêÑ Patel Farm Business Dashboard</h1>

<h3>Daily Report (All Customers)</h3>
<input type="date" id="dailyDate" onchange="generateDailyGraph()">

<canvas id="dailyChart"></canvas>

<hr>

<h3>Combined Monthly Report</h3>
<canvas id="monthlyChart"></canvas>

<hr>

<h3>Profit Calculator</h3>
<input type="number" id="feedCost" placeholder="Enter Monthly Feed Cost">
<button onclick="calculateProfit()">Calculate Profit</button>
<h3 id="profitResult"></h3>

</div>

<script>

// SIMPLE ADMIN PASSWORD
const ADMIN_PASSWORD = "1234";

function login(){
    let pass=document.getElementById("password").value;
    if(pass===ADMIN_PASSWORD){
        document.getElementById("loginPage").style.display="none";
        document.getElementById("dashboard").style.display="block";
        generateMonthlyGraph();
    }else{
        alert("Wrong Password");
    }
}

let customers = JSON.parse(localStorage.getItem("milkData")) || {};

let dailyChart, monthlyChart;

// DAILY GRAPH (ALL CUSTOMERS)
function generateDailyGraph(){
    let date=document.getElementById("dailyDate").value;
    if(!date) return;

    let labels=[];
    let data=[];

    for(let name in customers){
        let total=0;
        customers[name].forEach(e=>{
            if(e.date===date){
                total+=e.total;
            }
        });

        labels.push(name);
        data.push(total);
    }

    if(dailyChart) dailyChart.destroy();

    dailyChart=new Chart(document.getElementById("dailyChart"),{
        type:'bar',
        data:{
            labels:labels,
            datasets:[{
                label:'Income on '+date,
                data:data,
                backgroundColor:'green'
            }]
        }
    });
}

// MONTHLY COMBINED GRAPH
function generateMonthlyGraph(){
    let monthlyData={};

    for(let name in customers){
        customers[name].forEach(e=>{
            let month=e.date.substring(0,7);
            if(!monthlyData[month]){
                monthlyData[month]=0;
            }
            monthlyData[month]+=e.total;
        });
    }

    let labels=Object.keys(monthlyData);
    let data=labels.map(m=>monthlyData[m]);

    if(monthlyChart) monthlyChart.destroy();

    monthlyChart=new Chart(document.getElementById("monthlyChart"),{
        type:'line',
        data:{
            labels:labels,
            datasets:[{
                label:'Total Monthly Income (All Customers)',
                data:data,
                borderColor:'blue',
                fill:false
            }]
        }
    });
}

// PROFIT CALCULATION
function calculateProfit(){
    let feedCost=parseFloat(document.getElementById("feedCost").value);
    if(!feedCost) return alert("Enter feed cost");

    let totalIncome=0;

    for(let name in customers){
        customers[name].forEach(e=>{
            totalIncome+=e.total;
        });
    }

    let profit=totalIncome-feedCost;

    document.getElementById("profitResult").innerHTML=
        "Total Income: ‚Çπ "+totalIncome+"<br>Net Profit: ‚Çπ "+profit;
}

</script>
</body>
</html>
